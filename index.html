<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Scraper</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 900px; margin: 0 auto; padding: 24px; background: #f5f5f5; }
        h1 { margin: 0 0 24px; font-size: 1.5rem; color: #111; }
        form { display: flex; gap: 12px; margin-bottom: 32px; }
        input[type="search"] { flex: 1; padding: 12px 16px; font-size: 16px; border: 1px solid #ccc; border-radius: 8px; }
        button { padding: 12px 24px; font-size: 16px; background: #2563eb; color: #fff; border: none; border-radius: 8px; cursor: pointer; }
        button:hover { background: #1d4ed8; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .source { background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .source h2 { margin: 0 0 16px; font-size: 1.1rem; color: #333; border-bottom: 2px solid #eee; padding-bottom: 8px; }
        .job { padding: 16px 0; border-bottom: 1px solid #eee; }
        .job:last-child { border-bottom: none; }
        .job-title { font-weight: 600; margin-bottom: 4px; }
        .job-title a { color: #2563eb; text-decoration: none; }
        .job-title a:hover { text-decoration: underline; }
        .job-company { color: #666; font-size: 0.9rem; margin-bottom: 6px; }
        .job-desc { color: #555; font-size: 0.9rem; line-height: 1.4; }
        .empty { color: #888; font-style: italic; padding: 16px 0; }
        .term { color: #666; margin-bottom: 8px; }
        .loading { color: #666; padding: 16px 0; }
        .error { color: #b91c1c; padding: 16px 0; }
        .no-backend { background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-bottom: 24px; color: #92400e; font-size: 0.9rem; }
    </style>
</head>
<body>
    <h1>Job Scraper</h1>
    <form id="searchForm" role="search">
        <input type="search" id="q" name="q" placeholder="e.g. python, javascript, java" autofocus>
        <button type="submit" id="submitBtn">Search</button>
    </form>

    <div id="noBackend" class="no-backend" style="display: none;">
        GitHub Pages에서는 검색이 동작하지 않습니다. 검색을 쓰려면 Flask 앱을 Render 등에 배포한 뒤, 이 파일에서 API_BASE를 해당 URL로 바꾸세요.
    </div>

    <div id="results"></div>

    <script>
        var API_BASE = '';
        if (window.location.origin.indexOf('github.io') !== -1) {
            var noBackend = document.getElementById('noBackend');
            if (noBackend) noBackend.style.display = 'block';
        }

        function escapeHtml(s) {
            var div = document.createElement('div');
            div.textContent = s;
            return div.innerHTML;
        }

        function renderJob(job) {
            var desc = job.description || '';
            var shortDesc = desc.length > 200 ? desc.slice(0, 200) + '…' : desc;
            return '<div class="job">' +
                '<div class="job-title"><a href="' + escapeHtml(job.job_link) + '" target="_blank" rel="noopener">' + escapeHtml(job.job_title) + '</a></div>' +
                '<div class="job-company">' + escapeHtml(job.company_name) + '</div>' +
                '<div class="job-desc">' + escapeHtml(shortDesc) + '</div>' +
                '</div>';
        }

        function renderSource(title, jobs, emptyMsg) {
            var html = '<section class="source"><h2>' + escapeHtml(title) + '</h2>';
            if (jobs && jobs.length) {
                jobs.forEach(function(job) { html += renderJob(job); });
            } else {
                html += '<div class="empty">' + escapeHtml(emptyMsg) + '</div>';
            }
            html += '</section>';
            return html;
        }

        document.getElementById('searchForm').onsubmit = function(e) {
            e.preventDefault();
            var term = (document.getElementById('q').value || '').trim();
            if (!term) return;

            var resultsEl = document.getElementById('results');
            var btn = document.getElementById('submitBtn');
            btn.disabled = true;
            resultsEl.innerHTML = '<p class="loading">검색 중…</p>';

            var url = API_BASE + '/api/search?q=' + encodeURIComponent(term);
            fetch(url)
                .then(function(res) { return res.ok ? res.json() : Promise.reject(new Error('검색 실패')); })
                .then(function(data) {
                    var html = '<p class="term">Results for &ldquo;' + escapeHtml(term) + '&rdquo;</p>';
                    html += renderSource('Berlin Startup Jobs', data['berlinstartupjobs.com'] || [], 'No results');
                    html += renderSource('We Work Remotely', data['weworkremotely.com'] || [], 'No results (site may block automated requests)');
                    html += renderSource('Web3.Career', data['web3.career'] || [], 'No results');
                    resultsEl.innerHTML = html;
                })
                .catch(function(err) {
                    resultsEl.innerHTML = '<p class="error">' + escapeHtml(err.message || '검색 중 오류가 났습니다.') + '</p>';
                })
                .finally(function() { btn.disabled = false; });
        };
    </script>
</body>
</html>
